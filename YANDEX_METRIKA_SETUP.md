# Настройка Яндекс.Метрики для отслеживания целей

## Шаг 1 — Проверьте работу счетчика

Убедитесь, что:

1. **На целевой странице установлен счетчик** ✅
   - Код счетчика добавлен во все HTML файлы в секции `<head>`
   - ID счетчика: `99130561`

2. **Работу счетчика на сайте не блокируют другие скрипты** ✅
   - Счетчик загружается асинхронно
   - Проверка доступности перед отправкой событий

3. **Счетчик не заблокирован расширением Adblock Plus** ⚠️
   - Проверьте в браузере без блокировщиков рекламы

4. **Не настроены фильтры, исключающие учет целевой страницы** ⚠️
   - Проверьте настройки в панели Яндекс.Метрики

## Шаг 2 — Настройка целей в Яндекс.Метрике

Перейдите в панель Яндекс.Метрики и добавьте следующие цели:

### Цели для отслеживания кликов

| Название цели | Идентификатор | Описание |
|---------------|---------------|----------|
| Просмотр портфолио (главная) | `view_portfolio` | Клик по кнопке "Посмотреть работы" в главной секции |
| Просмотр портфолио (навигация) | `nav_portfolio` | Клик по ссылке "Портфолио" в десктопной навигации |
| Просмотр портфолио (мобильная) | `mobile_nav_portfolio` | Клик по ссылке "Портфолио" в мобильной навигации |
| Заказ эскиза (навигация) | `nav_order` | Клик по кнопке "Заказать эскиз" в десктопной навигации |
| Заказ эскиза (мобильная) | `mobile_nav_order` | Клик по кнопке "Заказать эскиза" в мобильной навигации |

### Как добавить цель в Яндекс.Метрике:

1. Войдите в панель Яндекс.Метрики
2. Выберите ваш сайт (ID: 99130561)
3. Перейдите в раздел "Цели"
4. Нажмите "Добавить цель"
5. Выберите тип "JavaScript-событие"
6. Введите идентификатор цели (например, `view_portfolio`)
7. Добавьте название цели (например, "Просмотр портфолио")
8. Сохраните цель

## Шаг 3 — Проверка работы отслеживания

### Проверка в консоли браузера:

1. Откройте сайт в браузере
2. Откройте Developer Tools (F12)
3. Перейдите на вкладку Console
4. Кликните по кнопке "Посмотреть работы"
5. В консоли должно появиться сообщение: `✅ Yandex Metrika goal reached: view_portfolio`

### Проверка в Яндекс.Метрике:

1. Перейдите в раздел "Отчеты" → "Стандартные отчеты" → "Цели"
2. Выберите нужную цель
3. Проверьте, что события засчитываются

## Код отслеживания

В проекте реализована система отслеживания с файлом `src/lib/yandex-metrika.ts`:

```typescript
// Основная функция отслеживания
trackYandexGoal(goalName: string, counterId: number = 99130561)

// Предопределенные цели
YANDEX_GOALS = {
  VIEW_PORTFOLIO: 'view_portfolio',
  NAV_PORTFOLIO: 'nav_portfolio',
  MOBILE_NAV_PORTFOLIO: 'mobile_nav_portfolio',
  NAV_ORDER: 'nav_order',
  MOBILE_NAV_ORDER: 'mobile_nav_order',
  // ... другие цели
}
```

## Возможные проблемы и решения

### Проблема: "yaCounter99130561 is not defined"
**Решение:** Убедитесь, что код счетчика загружается до вызова `reachGoal`

### Проблема: Цели не засчитываются
**Решение:** 
1. Проверьте правильность ID счетчика
2. Убедитесь, что идентификатор цели совпадает в коде и настройках
3. Проверьте, что счетчик не заблокирован

### Проблема: События отправляются до загрузки счетчика
**Решение:** Используйте функцию `trackYandexGoalWhenReady()` для ожидания загрузки

## Дополнительные возможности

В файле `yandex-metrika.ts` также реализованы:

- `isYandexMetrikaLoaded()` - проверка загрузки счетчика
- `trackYandexGoalWhenReady()` - отправка цели после загрузки счетчика
- Типизированные константы целей для предотвращения ошибок

## Тестирование

Для тестирования работы отслеживания:

1. Откройте сайт в режиме инкогнито
2. Отключите блокировщики рекламы
3. Проверьте консоль браузера на наличие сообщений об отправке целей
4. Проверьте отчеты в Яндекс.Метрике через несколько минут
